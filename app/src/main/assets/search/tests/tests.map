{"version":3,"sources":["tests/integration/basic.js"],"sourcesContent":["var expect = chai.expect;\n\nvar contentWindow, fakeServer;\n\nfunction cliqzResponse(query, results, extra) {\n  var results = JSON.stringify({\n    \"cached\": false,\n    \"choice\": \"type1\",\n    \"completions\": null,\n    \"country\": \"de\",\n    \"duration\": 52,\n    \"extra\": {\n      \"durationTotal\": 9,\n      \"vertical_name\": \"extra\",\n      \"results\": extra\n    },\n    \"navigational\": false,\n    \"q\": query,\n    \"result\": results\n  });\n\n  fakeServer.respondWith(\n    \"GET\",\n    new RegExp(\"^https:\\/\\/newbeta.cliqz.com\\/api\\/v1\\/results\\\\?q=\"+encodeURIComponent(query)),\n    [ 200, { \"Content-Type\": \"application/json\" }, results ]\n  );\n}\n\n\nfunction newsResponse(articles) {\n  var response = JSON.stringify({\n    \"results\": [\n      {\n        \"q\": \"\",\n        \"news_version\": 1455885880,\n        \"subType\": \"{\\\"class\\\": \\\"FreshTabNewsCache\\\", \\\"ez\\\": \\\"deprecated\\\"}\",\n        \"trigger_urls\": [\n\n        ],\n        \"articles\": [\n          {\n            \"domain\": \"www.focus.de\",\n            \"is_global\": false,\n            \"description\": \"\",\n            \"title\": \"USA bombardieren IS-St\\u00fctzpunkt in Libyen\",\n            \"url\": \"http:\\/\\/www.focus.de\\/politik\\/ausland\\/kampf-gegen-terrormiliz-medienbericht-usa-bombardieren-is-stuetzpunkt-in-libyen_id_5299559.html\",\n            \"short_title\": \"USA bombardieren IS-St\\u00fctzpunkt in Libyen\"\n          }\n        ]\n      }\n    ]\n  });\n\n  fakeServer.respondWith(\n    \"GET\",\n    new RegExp(\".*rich-header.*\"),\n    [ 200, { \"Content-Type\": \"application/json\" }, response ]\n  );\n}\n\nfunction $(selector) {\n\treturn contentWindow.document.querySelectorAll(selector)\n}\n\nfunction injectSinon(win) {\n  var resolver,\n      promise = new Promise(function (resolve) {\n        resolver = resolve;\n      });\n\n  var sinonScript = win.document.createElement(\"script\");\n  sinonScript.src = \"/bower_components/sinonjs/sinon.js\";\n  sinonScript.onload = function () {\n    window.sinon = contentWindow.sinon;\n    resolver();\n  };\n  win.document.body.appendChild(sinonScript);\n\n  return promise;\n}\n\ndescribe('Search View', function() {\n  var testBox;\n\n  beforeEach(function () {\n    // startup can be quite slow for the first time. Maybe there is better way\n    // to warm it up.\n    this.timeout(10000);\n    testBox = document.createElement(\"iframe\");\n    testBox.setAttribute(\"class\", \"testFrame\");\n    testBox.src = \t\"/build/index.html\";\n    document.body.appendChild(testBox);\n\n\n    contentWindow = testBox.contentWindow;\n\n    function waitForWindow(win) {\n      return new Promise(function (res) {\n        win.addEventListener('newsLoadingDone', function () { res(); });\n      })\n    }\n\n    return new Promise(function (resolve) {\n      contentWindow.onload = resolve;\n    }).then(function () {\n      return Promise.all([\n        injectSinon(contentWindow)\n      ])\n    }).then(function () {\n      fakeServer = sinon.fakeServer.create({\n        autoRespond: true,\n        respondImmediately: true\n      });\n      newsResponse([]);\n\n      contentWindow.sinonLoaded = true;\n      return waitForWindow(contentWindow);\n    });\n  });\n\n  afterEach(function () {\n  \tcontentWindow.CLIQZEnvironment.getLocalStorage().clear();\n    fakeServer.restore();\n    document.body.removeChild(testBox);\n  });\n\n  context(\"Local Results\", function () {\n    var query = \"kino cadillac\",\n        extraResult;\n\n    beforeEach(function (done) {\n      this.timeout(10000);\n\n      contentWindow.addEventListener('imgLoadingDone', function () { done() });\n\n      extraResult = {\n        \"q\": \"kino cadillac\",\n        \"ts\": 1455892138,\n        \"data\": {\n          \"__subType__\": {\n            \"class\": \"EntityLocal\",\n            \"id\": \"3087855600870963194\",\n            \"name\": \"cadillac.movieplace.de\"\n          },\n          \"address\": \"Rosenkavalierpl. 12, 81925 München, Germany\",\n          \"desc\": \"Cadillac Veranda Kino, München, Aktuelles Kinoprogramm, Kino, Film- und Kino-Infos, Online-Tickets, News, Events und vieles mehr...\",\n          \"description\": \"Cadillac Veranda Kino, München, Aktuelles Kinoprogramm, Kino, Film- und Kino-Infos, Online-Tickets, News, Events und vieles mehr...\",\n          \"friendly_url\": \"cadillac.movieplace.de\",\n          \"lat\": 48.1517753,\n          \"lon\": 11.6197005,\n          \"map_img\": \"http://maps.google.com/maps/api/staticmap?size=124x124\\u0026zoom=16\\u0026center=48.1517753,11.6197005\\u0026format=png\\u0026markers=size:mid|color:red|label:C|48.1517753,11.6197005\",\n          \"mu\": \"https://www.google.de/maps/place/cadillac+veranda/data=!4m2!3m1!1s0x0:0xec7891cbdf1a3b49?sa=X\\u0026ved=0CFMQrwswAWoVChMI492LqdXuxwIVAtMUCh2-rwzi\",\n          \"opening_hours\": [],\n          \"phonenumber\": \"089 912000\",\n          \"rating\": 4.6,\n          \"superTemplate\": \"local-data-sc\",\n          \"t\": \"Cadillac \\u0026 Veranda Kino\",\n          \"template\": \"generic\",\n          \"timestamp\": 1.443973887175803e+09,\n          \"title\": \"Kino in München: Cadillac Veranda Kino mit Kinoprogramm, Infos rund ums Kino und die Filme, Filmtrailern und vielem mehr.\",\n          \"u\": \"cadillac.movieplace.de\"\n        },\n        \"url\": \"http://cadillac.movieplace.de/\",\n        \"subType\": \"{\\\"class\\\": \\\"EntityLocal\\\", \\\"ez\\\": \\\"deprecated\\\"}\"\n      };\n\n      cliqzResponse(query, [], [ extraResult ]);\n\n      contentWindow.jsAPI.search(query, true, 48.151753799999994, 11.620054999999999);\n    });\n\n    it(\"has one local result\", function () {\n      expect($('.local')).to.have.length(1);\n    });\n\n    it(\"renders local template with address and map\", function () {\n      var address = $('.cqz-local-address')[0];\n      expect(address).to.be.ok;\n\n      var addressText = address.lastChild.wholeText;\n      expect(addressText).to.be.ok;\n      expect(addressText.trim()).to.equal(extraResult.data.address);\n    });\n\n    it(\"shows local data image\", function () {\n      var img = $('.local-data-img')[0];\n      expect(img).to.be.ok\n      expect(img).to.have.property('style');\n      expect(img.style).to.have.property('display').that.not.equal('none');\n    });\n  });\n\n  context(\"Generic Entities\", function () {\n    var query = \"amazon\";\n\n    beforeEach(function (done) {\n      this.timeout(10000);\n\n      contentWindow.addEventListener('imgLoadingDone', function () { done() });\n\n      cliqzResponse(query, [], [\n        {\n          \"q\": \"amazon\",\n          \"ts\": 1456133009,\n          \"data\": {\n            \"__subType__\": {\n              \"class\": \"EntityGeneric\",\n              \"id\": \"3513337026156341491\",\n              \"name\": \"https://www.amazon.de/\"\n            },\n            \"actions\": [\n              {\n                  \"color\": \"\",\n                  \"title\": \"Mein Konto\",\n                  \"url\": \"http://www.amazon.de/mein-konto\"\n              },\n              {\n                  \"color\": \"\",\n                  \"title\": \"Einkaufswagen\",\n                  \"url\": \"http://www.amazon.de/gp/cart/view.html/ref=nav_cart\"\n              },\n              {\n                  \"color\": \"\",\n                  \"title\": \"Meine Bestellungen\",\n                  \"url\": \"https://www.amazon.de/gp/css/order-history\"\n              },\n              {\n                  \"color\": \"\",\n                  \"title\": \"Wunschzettel\",\n                  \"url\": \"http://www.amazon.de/gp/registry/wishlist\"\n              }\n            ],\n            \"description\": \"Entdecken, shoppen und einkaufen bei Amazon.de: Günstige Preise für Elektronik \\u0026 Foto, Filme, Musik, Bücher, Games, Spielzeug, Sportartikel, Drogerie \\u0026 mehr bei Amazon.de\",\n            \"friendly_url\": \"amazon.de\",\n            \"icon\": \"http://cdn.cliqz.com/extension/EZ/generic/EZ-shopping.svg\",\n            \"links\": [\n              {\n                \"icon\": \"http://cdn.cliqz.com/extension/EZ/generic/angebote.svg\",\n                \"title\": \"Sonderangebote\",\n                \"url\": \"http://www.amazon.de/gp/angebote/ref=nav_cs_top_nav_gb27\"\n              },\n              {\n                \"icon\": \"http://cdn.cliqz.com/extension/EZ/generic/clips.svg\",\n                \"title\": \"Prime Instant Video\",\n                \"url\": \"http://www.amazon.de/Prime-Instant-Video/b/ref=nav_shopall_aiv_piv?ie=UTF8\\u0026node=3279204031\"\n              },\n              {\n                \"icon\": \"http://cdn.cliqz.com/extension/EZ/generic/music.svg\",\n                \"title\": \"Musik-Downloads\",\n                \"url\": \"http://www.amazon.de/MP3-Musik-Downloads/b/ref=nav_shopall_mp3_str?ie=UTF8\\u0026node=77195031\"\n              },\n              {\n                \"icon\": \"http://cdn.cliqz.com/extension/EZ/generic/disc.svg\",\n                \"title\": \"DVD \\u0026 Blu-ray\",\n                \"url\": \"http://www.amazon.de/dvd-blu-ray-filme-3D-vhs-video/b/ref=nav_shopall_dvd_blu?ie=UTF8\\u0026node=284266\"\n              }\n            ],\n            \"name\": \"Amazon\",\n            \"template\": \"entity-generic\"\n          },\n          \"url\": \"https://www.amazon.de/\",\n          \"subType\": \"{\\\"class\\\": \\\"EntityGeneric\\\", \\\"ez\\\": \\\"deprecated\\\"}\",\n          \"trigger_urls\": [\n              \"amazon.de\"\n          ]\n        }\n      ]);\n\n      contentWindow.jsAPI.search(query);\n    });\n\n    it(\"should render generic template\", function () {\n      expect($(\"#cliqz-results\")[0].innerHTML).to.contain('<!-- generic.tpl -->');\n    });\n  });\n\n  context(\"Adult Filter\", function () {\n    var query = \"titten\";\n\n    beforeEach(function (done) {\n      this.timeout(10000);\n\n      contentWindow.addEventListener('imgLoadingDone', function () { done() });\n\n      cliqzResponse(query, [\n        {\n          \"q\": \"titten\",\n          \"url\": \"http://www.einfachporno.com/pornofilme/grosse-titten\",\n          \"score\": 334.36624,\n          \"source\": \"bm\",\n          \"snippet\": {\n            \"adult\": true,\n            \"alternatives\": [\n              \"http://www.einfachporno.com/pornofilme/grosse-titten/\"\n            ],\n            \"desc\": \"Grosse Titten :: Kostenlose porno von Grosse Titten. Auf Einfachporno finden Sie alle Pornofilme von Grosse Titten die Sie sich können vorstellen. Nur hier Qualitätsporno.\",\n            \"language\": {\n              \"nl\": 0.9594114735588574\n            },\n            \"title\": \"Grosse Titten\"\n          }\n        }\n      ], []);\n\n      contentWindow.jsAPI.search(query);\n    });\n\n    it(\"should filter all results\", function () {\n      expect($(\"#cliqz-results\")[0].innerHTML).to.contain('<!-- noResult.tpl -->');\n    });\n  });\n\n  context(\"Weather\", function () {\n    var query = \"wetter münchen\";\n\n    beforeEach(function (done) {\n      this.timeout(10000);\n\n      contentWindow.addEventListener('imgLoadingDone', function () { done() });\n\n      cliqzResponse(query, [], [\n        {\n          \"q\": \"wetter mun\",\n          \"ts\": 1456133409,\n          \"data\": {\n            \"__subType__\": {\n              \"class\": \"EntityWeather\",\n              \"id\": \"5138280142441694865\",\n              \"name\": \"weather EZ\"\n            },\n            \"alert\": {\n              \"alert-color\": \"#ffc802\",\n              \"des\": \"Wetterwarnung: Wind\",\n              \"icon_url\": \"http://cdn.cliqz.com/extension/EZ/weather-new2/warning_2.svg\",\n              \"time\": \"aktiv seit 22.02.16, 11:00 Uhr\"\n            },\n            \"api_returned_location\": \"München, Germany\",\n            \"forecast\": [\n              {\n                \"desc\": \"Rain\",\n                \"description\": \"Regen\",\n                \"icon\": \"http://cdn.cliqz.com/extension/EZ/weather-new2/rain.svg\",\n                \"icon_bck\": \"http://icons.wxug.com/i/c/k/rain.gif\",\n                \"max\": \"9°\",\n                \"min\": \"0°\",\n                \"weekday\": \"Dienstag\"\n              },\n              {\n                \"desc\": \"Partly Cloudy\",\n                \"description\": \"Teilweise bewölkt\",\n                \"icon\": \"http://cdn.cliqz.com/extension/EZ/weather-new2/mostly-sunny.svg\",\n                \"icon_bck\": \"http://icons.wxug.com/i/c/k/partlycloudy.gif\",\n                \"max\": \"7°\",\n                \"min\": \"-1°\",\n                \"weekday\": \"Mittwoch\"\n              },\n              {\n                \"desc\": \"Snow Showers\",\n                \"description\": \"Schneeregen\",\n                \"icon\": \"http://cdn.cliqz.com/extension/EZ/weather-new2/snow.svg\",\n                \"icon_bck\": \"http://icons.wxug.com/i/c/k/snow.gif\",\n                \"max\": \"4°\",\n                \"min\": \"-2°\",\n                \"weekday\": \"Donnerstag\"\n              },\n              {\n                \"desc\": \"Partly Cloudy\",\n                \"description\": \"Teilweise bewölkt\",\n                \"icon\": \"http://cdn.cliqz.com/extension/EZ/weather-new2/mostly-sunny.svg\",\n                \"icon_bck\": \"http://icons.wxug.com/i/c/k/partlycloudy.gif\",\n                \"max\": \"5°\",\n                \"min\": \"-3°\",\n                \"weekday\": \"Freitag\"\n              }\n            ],\n            \"forecast_url\": \"http://www.wunderground.com/global/stations/10865.html#forecast\",\n            \"friendly_url\": \"wunderground.com/global/stations/10865.html\",\n            \"meta\": {\n              \"cached_weather_data\": \"yes\",\n              \"lazy-RH\": 0.008195161819458008,\n              \"lazy-RH1\": 0.007915019989013672,\n              \"lazy-snpt1\": 0.0010120868682861328,\n              \"location\": \"München, Deutschland\",\n              \"version\": \"21Dec15\"\n            },\n            \"returned_location\": \"München, Deutschland\",\n            \"searched_city\": \"mun\",\n            \"searched_country\": \"Germany - default\",\n            \"template\": \"weatherAlert\",\n            \"title_icon\": \"http://cdn.cliqz.com/extension/EZ/weather-new2/weather.svg\",\n            \"todayDesc\": \"Clear\",\n            \"todayDescription\": \"Klar\",\n            \"todayIcon\": \"http://cdn.cliqz.com/extension/EZ/weather-new2/clear---day.svg\",\n            \"todayIcon_bck\": \"http://icons.wxug.com/i/c/k/clear.gif\",\n            \"todayMax\": \"16°\",\n            \"todayMin\": \"7°\",\n            \"todayTemp\": \"15°\",\n            \"todayWeekday\": \"Heute\"\n          },\n          \"url\": \"http://www.wunderground.com/global/stations/10865.html\",\n          \"subType\": \"{\\\"class\\\": \\\"EntityWeather\\\", \\\"ez\\\": \\\"deprecated\\\"}\"\n        }\n      ]);\n\n      contentWindow.jsAPI.search(query);\n    });\n\n    it(\"should have the weather card\", function () {\n      expect($('.EZ-weather-container')).to.have.length(5);\n      expect($('.EZ-weather-img')).to.have.length(5);\n    });\n  });\n\n  context(\"FC Bayern\", function () {\n    var query = \"fcbayern\";\n\n    beforeEach(function (done) {\n      this.timeout(10000);\n\n      contentWindow.addEventListener('imgLoadingDone', function () { done() });\n\n      cliqzResponse(query, [], [\n        {\n          \"q\": \"fcbayern\",\n          \"ts\": 1456133742,\n          \"data\": {\n            \"GUESS\": \"SV Darmstadt 98\",\n            \"HOST\": \"Bayern München\",\n            \"__subType__\": {\n              \"class\": \"SoccerEZ\",\n              \"id\": \"2296372664814577417\",\n              \"name\": \"1. Bundesliga EZ CLUB\"\n            },\n            \"club\": \"Bayern München\",\n            \"debug\": {\n              \"club_name_tmp3\": \"Bayern München\"\n            },\n            \"friendly_url\": \"fcbayern.de\",\n            \"gameTime\": \"Samstag 20 Februar, 15:30\",\n            \"leagueName\": \"1. Bundesliga\",\n            \"live_url\": \"http://www.kicker.de/news/fussball/bundesliga/spieltag/1-bundesliga/2015-16/22/2855122/spielbericht_bayern-muenchen-14_sv-darmstadt-98-98.html\",\n            \"location\": \"Allianz-Arena\",\n            \"rank\": \"1. Bundesliga Position: 1\",\n            \"scored\": \"3 - 1\",\n            \"spielTag\": \"22. Spieltag\",\n            \"static\": {\n              \"actions\": [\n                {\n                  \"color\": \"\",\n                  \"title\": \"Warenkorb\",\n                  \"url\": \"http://shop.fcbayern.de/?action=viewcart\"\n                }\n              ],\n              \"description\": \"Willkommen auf dem offiziellen Internetportal des FC Bayern München! Hier gibt es aktuelle News, Spielberichte, FCB.tv-Videos, Online-Shop, FCB Erlebniswelt u.v.m. Klicken Sie rein!\",\n              \"links\": [\n                {\n                  \"icon\": \"http://cdn.cliqz.com/extension/EZ/generic/note.svg\",\n                  \"title\": \"Tickets\",\n                  \"url\": \"http://www.fcbayern.de/de/tickets/\"\n                },\n                {\n                  \"icon\": \"http://cdn.cliqz.com/extension/EZ/generic/schedule.svg\",\n                  \"title\": \"Spielplan\",\n                  \"url\": \"http://www.fcbayern.de/de/spiele/spielplan/bundesliga/\"\n                },\n                {\n                  \"icon\": \"http://cdn.cliqz.com/extension/EZ/generic/television.svg\",\n                  \"title\": \"FCB.tv\",\n                  \"url\": \"http://www.fcb.tv/de/\"\n                },\n                {\n                  \"icon\": \"http://cdn.cliqz.com/extension/EZ/generic/shopping.svg\",\n                  \"title\": \"Fan Shop\",\n                  \"url\": \"http://shop.fcbayern.de/\"\n                }\n              ],\n              \"name\": \"FC Bayern München\",\n              \"url\": \"http://www.fcbayern.de/\"\n            },\n            \"template\": \"ligaEZ1Game\"\n          },\n          \"url\": \"http://www.fcbayern.de/\",\n          \"subType\": \"{\\\"class\\\": \\\"SoccerEZ\\\", \\\"ez\\\": \\\"deprecated\\\"}\"\n        },\n      ]);\n\n      contentWindow.jsAPI.search(query);\n    });\n\n    it(\"should have the latest results smart card\", function () {\n      expect($('.soccer__result')).to.have.length(1);\n      expect($('.meta__legend')).to.have.length(1);\n    });\n  });\n});\n\ndescribe(\"Freshtab\", function () {\n  var testBox, getTopSites;\n\n  beforeEach(function () {\n    // startup can be quite slow for the first time. Maybe there is better way\n    // to warm it up.\n    this.timeout(10000);\n    testBox = document.createElement(\"iframe\");\n    testBox.setAttribute(\"class\", \"testFrame\");\n    testBox.src =   \"/build/index.html\";\n    document.body.appendChild(testBox);\n\n\n    contentWindow = testBox.contentWindow;\n\n    function waitForWindow(win) {\n      return new Promise(function (res) {\n        win.addEventListener('newsLoadingDone', function () { res(); });\n      });\n    }\n\n    return new Promise(function (resolve) {\n      contentWindow.onload = resolve;\n    }).then(function () {\n      return Promise.all([\n        injectSinon(contentWindow)\n      ])\n    }).then(function () {\n      fakeServer = sinon.fakeServer.create({\n        autoRespond: true,\n        respondImmediately: true\n      });\n      newsResponse([]);\n\n      contentWindow.sinonLoaded = true;\n      return waitForWindow(contentWindow);\n    });\n  });\n\n  afterEach(function () {\n    contentWindow.CLIQZEnvironment.getLocalStorage().clear();\n    fakeServer.restore();\n    document.body.removeChild(testBox);\n  });\n\n  context(\"display topsites\", function () {\n    beforeEach(function () {\n      contentWindow.osAPI.openLink(\"http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html\");\n      contentWindow.osAPI.openLink('http://www.manager-magazin.de/unternehmen/artikel/bayer-uebernahmepoker-mit-monsanto-geht-weiter-a-1094026.html');\n      contentWindow.jsAPI.search();\n    });\n\n    it(\"display 2 top sites from history\", function () {\n      const topsites = $('.topSitesLink');\n      expect(topsites).to.have.length(2);\n      expect(topsites[0].getAttribute('url')).to.equal('http://www.manager-magazin.de/unternehmen/artikel/bayer-uebernahmepoker-mit-monsanto-geht-weiter-a-1094026.html');\n      expect(topsites[1].getAttribute('url')).to.equal('http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html');\n    });\n  });\n\n  context(\"block 1 of to topsites\", function () {\n    beforeEach(function () {\n      contentWindow.osAPI.openLink(\"http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html\");\n      contentWindow.osAPI.openLink('http://www.manager-magazin.de/unternehmen/artikel/bayer-uebernahmepoker-mit-monsanto-geht-weiter-a-1094026.html');\n      contentWindow.jsAPI.search();\n      $('.blockTopsite')[0].click();\n      $('#doneEditTopsites')[0].click();\n      contentWindow.jsAPI.search();\n    });\n\n    it(\"should display 1 website\", function () {\n      const topsites = $('.topSitesLink');\n      expect(topsites).to.have.length(1);\n      expect(topsites[0].getAttribute('url')).to.equal('http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html');\n    });\n  });\n\n  context(\"Hide blocked topsites forever\", function () {\n    beforeEach(function () {\n      contentWindow.osAPI.openLink(\"http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html\");\n      contentWindow.osAPI.openLink('http://www.manager-magazin.de/unternehmen/artikel/bayer-uebernahmepoker-mit-monsanto-geht-weiter-a-1094026.html');\n      contentWindow.jsAPI.search();\n      $('.blockTopsite')[0].click();\n      $('#doneEditTopsites')[0].click();\n      contentWindow.osAPI.openLink('http://www.manager-magazin.de/unternehmen/artikel/bayer-uebernahmepoker-mit-monsanto-geht-weiter-a-1094026.html');\n      contentWindow.jsAPI.search();\n    });\n\n    it(\"should not display the blocked topsite again\", function () {\n      const topsites = $('.topSitesLink');\n      expect(topsites).to.have.length(1);\n      expect(topsites[0].getAttribute('url')).to.equal('http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html');\n    });\n  });\n\n  context(\"Cancel blocking topsites\", function () {\n    beforeEach(function () {\n      contentWindow.osAPI.openLink(\"http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html\");\n      contentWindow.osAPI.openLink('http://www.manager-magazin.de/unternehmen/artikel/bayer-uebernahmepoker-mit-monsanto-geht-weiter-a-1094026.html');\n      contentWindow.jsAPI.search();\n      $('.blockTopsite')[0].click();\n      $('.blockTopsite')[0].click();\n      $('#cancelEditTopsites')[0].click();\n      contentWindow.jsAPI.search();\n    });\n\n    it(\"should not deleted the blocked topsite again\", function () {\n      const topsites = $('.topSitesLink');\n      expect(topsites).to.have.length(2);\n      expect(topsites[0].getAttribute('url')).to.equal('http://www.manager-magazin.de/unternehmen/artikel/bayer-uebernahmepoker-mit-monsanto-geht-weiter-a-1094026.html');\n      expect(topsites[1].getAttribute('url')).to.equal('http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html');\n    });\n  });\n\n  context(\"restore blocked topsites\", function () {\n    beforeEach(function () {\n      contentWindow.osAPI.openLink(\"http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html\");\n      contentWindow.osAPI.openLink('http://www.manager-magazin.de/unternehmen/artikel/bayer-uebernahmepoker-mit-monsanto-geht-weiter-a-1094026.html');\n      contentWindow.jsAPI.search();\n      $('.blockTopsite')[1].click();\n      $('#doneEditTopsites')[0].click();\n      contentWindow.jsAPI.restoreBlockedTopSites();\n      contentWindow.jsAPI.search();\n    });\n\n    it(\"should display the restored topsites\", function () {\n      const topsites = $('.topSitesLink');\n      expect(topsites).to.have.length(2);\n      expect(topsites[0].getAttribute('url')).to.equal('http://www.manager-magazin.de/unternehmen/artikel/bayer-uebernahmepoker-mit-monsanto-geht-weiter-a-1094026.html');\n      expect(topsites[1].getAttribute('url')).to.equal('http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html');\n    });\n  });\n\n  context(\"Deduplicate sites with common domain\", function () {\n    beforeEach(function () {\n      contentWindow.osAPI.openLink(\"http://www.tagesschau.de/eilmeldung/eilmeldung-1203.html\");\n      contentWindow.osAPI.openLink(\"http://www.tagesschau.com/eilmeldung/eilmeldung-1204.html\");\n      contentWindow.osAPI.openLink(\"http://m.tagesschau.de/eilmeldung/eilmeldung-1205.html\");\n      contentWindow.jsAPI.search();\n    });\n\n    it(\"should display one topsite\", function () {\n      const topsites = $('.topSitesLink');\n      expect(topsites).to.have.length(1);\n    });\n  });\n});\n\n\n\ndescribe(\"Startup\", function () {\n  var testBox;\n\n  beforeEach(function () {\n    // startup can be quite slow for the first time. Maybe there is better way\n    // to warm it up.\n    this.timeout(10000);\n    testBox = document.createElement(\"iframe\");\n    testBox.setAttribute(\"class\", \"testFrame\");\n    testBox.src =   \"/build/index.html\";\n    document.body.appendChild(testBox);\n\n\n    contentWindow = testBox.contentWindow;\n\n    function waitForWindow(win) {\n      return new Promise(function (res) {\n        win.addEventListener('newsLoadingDone', function () { res(); });\n      });\n    }\n\n    return new Promise(function (resolve) {\n      contentWindow.onload = resolve;\n    }).then(function () {\n      return Promise.all([\n        injectSinon(contentWindow)\n      ])\n    }).then(function () {\n      fakeServer = sinon.fakeServer.create({\n        autoRespond: true,\n        respondImmediately: true\n      });\n      newsResponse([]);\n\n      contentWindow.sinonLoaded = true;\n      return waitForWindow(contentWindow);\n    });\n  });\n\n  afterEach(function () {\n    contentWindow.CLIQZEnvironment.getLocalStorage().clear();\n    fakeServer.restore();\n    document.body.removeChild(testBox);\n  });\n\n  context(\"Language loading\", function () {\n\n    beforeEach(function () {\n      contentWindow.sinon.FakeXMLHttpRequest.addFilter(function (method, url) {return url.indexOf('static/locale/') !== -1;});\n      contentWindow.sinon.FakeXMLHttpRequest.useFilters = true;\n      contentWindow.CliqzUtils.locale = {};\n    });\n\n    it(\"should load default language if locale is not recognized\", function (done) {\n      contentWindow.CliqzUtils.loadLocale('it-IT').then(function () {\n        expect(contentWindow.CliqzUtils.locale['it-IT']).to.be.not.ok;\n        expect(contentWindow.CliqzUtils.locale.default).to.be.ok;\n        done();\n      });\n    });\n  });\n});"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;","file":"tests.js"}